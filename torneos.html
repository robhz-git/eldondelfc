<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liga ElDonDelFC | Dashboard Anual 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #070707; --neon: #ff003c; --gold: #d4af37; --glass: rgba(15, 15, 15, 0.95); }
        body { 
            background: var(--bg); color: white; font-family: 'Rajdhani', sans-serif; margin: 0;
            background-image: radial-gradient(circle at center, transparent 0%, var(--bg) 90%),
            url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='152' height='152' viewBox='0 0 152 152'%3E%3Cg fill='%23d4af37' fill-opacity='0.03'%3E%3Cpath d='M152 150v2H0v-2h28v-8H8v-20H0v-2h8V80h42v20h20v42H30v8h122zm-20-46v-20h8v20h-8zM52 30V10h8v20h-8zM0 102h8v20H0v-20zm52 30h8v20h-8v-20zm100-22h-8v20h8v-20zm-100-62h8v20h-8V48zm88 62h8v20h-8v-20zm-88-22h8v20h-8v-20zm88-22h8v20h-8V64zm-88-22h8v20h-8V42zm88-22h8v20h-8V20zm-44 40h8v20h-8V60zm0 42h8v20h-8v-20zm0-84h8v20h-8V18zm0 126h8v20h-8v-20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            background-attachment: fixed;
        }

        .main-container { display: grid; grid-template-columns: 1fr 300px; gap: 20px; max-width: 1200px; margin: 0 auto; padding: 20px; }
        .card { background: var(--glass); border: 1px solid rgba(212,175,55,0.2); padding: 20px; border-radius: 12px; margin-bottom: 20px; }
        h2, h3 { font-family: 'Orbitron'; color: var(--gold); text-transform: uppercase; margin-top: 0; }

        /* Pestañas de Ligas */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-btn { 
            background: transparent; color: var(--gold); border: 1px solid var(--gold); padding: 10px 20px; 
            font-family: 'Orbitron'; cursor: pointer; border-radius: 5px; transition: 0.3s; white-space: nowrap;
        }
        .tab-btn.active { background: var(--gold); color: black; box-shadow: 0 0 15px rgba(212,175,55,0.3); }

        /* Tabla Estilizada */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; text-align: center; }
        th { background: rgba(212,175,55,0.1); color: var(--gold); font-family: 'Orbitron'; padding: 12px; font-size: 0.75rem; }
        td { padding: 12px; border-bottom: 1px solid #222; font-size: 1.1rem; }
        tr:nth-child(1) td { color: var(--gold); font-weight: bold; } /* Resaltar Líder */

        /* Formulario Admin */
        #admin-panel { display: none; border-top: 2px solid var(--neon); padding-top: 20px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; }
        label { display: block; font-family: 'Orbitron'; font-size: 0.7rem; color: var(--gold); margin-bottom: 5px; }
        input, select { background: #111; border: 1px solid #444; color: white; padding: 10px; border-radius: 5px; width: 100%; box-sizing: border-box; }
        
        .btn-main { background: var(--gold); color: black; border: none; padding: 12px 20px; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; border-radius: 5px; width: 100%; transition: 0.3s; }
        .btn-main:hover { background: white; box-shadow: 0 0 20px var(--gold); }
        .status-badge { background: var(--neon); color: white; padding: 4px 10px; border-radius: 4px; font-family: 'Orbitron'; font-size: 0.8rem; }

        .sidebar { position: sticky; top: 20px; height: fit-content; text-align: center; }
        .avatar { width: 180px; filter: drop-shadow(0 0 10px var(--gold)); margin-bottom: 15px; }

        @media (max-width: 850px) { .main-container { grid-template-columns: 1fr; } .sidebar { position: static; order: -1; } }
    </style>
</head>
<body>

<div class="main-container">
    <div class="content">
        <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
            <h1 style="font-family:'Orbitron'; margin:0; font-size: 1.4rem;">CENTRO DE COMPETICIÓN</h1>
            <div id="torneo-name-display"><span class="status-badge">SINCRONIZANDO...</span></div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="cambiarLiga('Stats_Otoño', this)">LIGA OTOÑO</button>
            <button class="tab-btn" onclick="cambiarLiga('Stats_Verano', this)">LIGA VERANO</button>
            <button class="tab-btn" onclick="cambiarLiga('Stats_Invierno', this)">LIGA INVIERNO</button>
        </div>

        <div class="card">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>POS / JUGADOR</th><th>PJ</th><th>G</th><th>E</th><th>P</th><th>GF</th><th>GC</th><th>GD</th><th>PTS</th>
                        </tr>
                    </thead>
                    <tbody id="stats-body">
                        <tr><td colspan="9">Conectando con el estadio...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <button class="btn-main" onclick="toggleAdmin()" style="background:var(--neon); color:white; margin-bottom: 20px;">
            <i class="fas fa-lock"></i> PANEL DE ADMINISTRADOR
        </button>

        <div id="admin-panel" class="card">
            <h3>REGISTRO DE PARTIDO OFICIAL</h3>
            <form id="result-form">
                <div class="form-grid">
                    <div>
                        <label>ADMIN TOKEN</label>
                        <input type="password" id="token" required>
                    </div>
                    <div>
                        <label>LIGA DESTINO</label>
                        <select id="torneo-select" required><option value="">Cargando ligas...</option></select>
                    </div>
                    <div>
                        <label>FASE / JORNADA</label>
                        <input type="text" id="fase" value="Jornada 1">
                    </div>
                    <div>
                        <label>JUGADOR A</label>
                        <input type="text" id="jugadorA" required>
                    </div>
                    <div>
                        <label>EQUIPO A</label>
                        <select id="equipoA" required><option value="">Cargando...</option></select>
                    </div>
                    <div style="text-align:center; font-family:'Orbitron'; font-size:1.5rem; color:var(--gold); padding-top:20px;">VS</div>
                    <div>
                        <label>EQUIPO B</label>
                        <select id="equipoB" required><option value="">Cargando...</option></select>
                    </div>
                    <div>
                        <label>JUGADOR B</label>
                        <input type="text" id="jugadorB" required>
                    </div>
                    <div>
                        <label>GOLES A</label>
                        <input type="number" id="golesA" min="0" required>
                    </div>
                    <div>
                        <label>GOLES B</label>
                        <input type="number" id="golesB" min="0" required>
                    </div>
                    <div style="grid-column: span 2;">
                        <label>LINK CAPTURA (DISCORD)</label>
                        <input type="url" id="captura" placeholder="https://cdn.discordapp.com/..." required>
                    </div>
                </div>
                <button type="submit" class="btn-main" style="margin-top:20px; background:var(--gold); color:black;">PUBLICAR RESULTADO</button>
            </form>
        </div>
    </div>

    <aside class="sidebar">
        <div class="card">
            <img src="avatar.png" alt="ElDonDelFC" class="avatar">
            <h2 style="font-size: 1rem;">EL DON DEL FC</h2>
            <p style="font-size: 0.8rem; color: var(--gold);">COMMANDER • EXPERT</p>
            <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
            <a href="index.html" class="btn-main" style="font-size:0.7rem;">VOLVER AL PORTAL</a>
        </div>
    </aside>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyo-TDES--Rbm8sHT8duYCuK7iGbU-RjTYjTSVkEJN1-rBXLNXYOXqs-iVY5qgC5K4p/exec";
    let datosGlobales = {};

    async function init() {
        await cargarEstadisticas();
        await cargarListas();
    }

    async function cargarEstadisticas() {
        try {
            const res = await fetch(SCRIPT_URL);
            datosGlobales = await res.json();
            cambiarLiga('Stats_Otoño', document.querySelector('.tab-btn'));
        } catch (e) { document.getElementById('stats-body').innerHTML = "Error al cargar datos."; }
    }

    async function cargarListas() {
        const res = await fetch(SCRIPT_URL + "?action=getListas");
        const listas = await res.json();
        const fill = (id, arr) => {
            const el = document.getElementById(id);
            arr.forEach(item => el.innerHTML += `<option value="${item}">${item}</option>`);
        };
        fill('torneo-select', listas.ligas);
        fill('equipoA', listas.equipos);
        fill('equipoB', listas.equipos);
    }

    function cambiarLiga(nombre, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        const body = document.getElementById('stats-body');
        const rows = datosGlobales[nombre];
        document.getElementById('torneo-name-display').innerHTML = `<span class="status-badge">${nombre.replace('_', ' ')}</span>`;

        if (!rows || rows.length <= 1) {
            body.innerHTML = '<tr><td colspan="9">Sin datos registrados aún.</td></tr>';
            return;
        }

        let html = "";
        for (let i = 1; i < rows.length; i++) {
            if (rows[i][0] === "JUGADOR" || rows[i][0] === "Esperando datos...") continue;
            html += `<tr>
                <td style="color:var(--gold); font-weight:bold;">${rows[i][0]}</td>
                <td>${rows[i][1]}</td>
                <td style="color:#00ff88;">${rows[i][2]}</td>
                <td>${rows[i][3]}</td>
                <td style="color:var(--neon);">${rows[i][4]}</td>
                <td>${rows[i][5]}</td><td>${rows[i][6]}</td>
                <td>${rows[i][7]}</td>
                <td style="color:var(--gold); font-weight:bold; font-size:1.3rem;">${rows[i][8]}</td>
            </tr>`;
        }
        body.innerHTML = html;
    }

    function toggleAdmin() {
        const p = document.getElementById('admin-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    document.getElementById('result-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const b = e.target.querySelector('button');
        b.innerText = "REGISTRANDO..."; b.disabled = true;

        const payload = {
            token: document.getElementById('token').value,
            torneo: document.getElementById('torneo-select').value,
            fase: document.getElementById('fase').value,
            jugadorA: document.getElementById('jugadorA').value,
            equipoA: document.getElementById('equipoA').value,
            golesA: document.getElementById('golesA').value,
            golesB: document.getElementById('golesB').value,
            equipoB: document.getElementById('equipoB').value,
            jugadorB: document.getElementById('jugadorB').value,
            captura: document.getElementById('captura').value
        };

        try {
            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
            alert("¡RESULTADO ENVIADO!\nLa tabla se actualizará pronto.");
            location.reload();
        } catch (err) { alert("Error al enviar."); b.innerText = "PUBLICAR RESULTADO"; b.disabled = false; }
    });

    init();
</script>
</body>
</html>
